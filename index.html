<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Jogo de Tradu√ß√£o ‚Äì Modo Desafio</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --primary: #00b7a3;
      --gray: #f4f4f6;
      --dark: #1d1d1f;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: #fff;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 20px;
    }
    #toggleConfigBtn { display: none; }
    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 60px;
      max-width: 1200px;
      width: 100%;
      justify-content: center;
      align-items: flex-start;
      position: relative;
    }
    /* === Timer === */
    #timer {
      position: fixed;
      top: 20px;
      left: 20px;
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
      background: #f8f8f8;
      padding: 8px 14px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      z-index: 1000;
      transition: color .3s ease;
    }
    #timer.low { color: red; }

    .left-panel {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #translate-container {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
      position: relative;
      text-align: center;
      width: 200px;
    }
    #translate-word { color: var(--primary); text-transform: uppercase; }
    #typed-word {
      display: flex;
      gap: 4px;
      font-size: 18px;
      margin: 0 0 16px;
      text-transform: uppercase;
      justify-content: center;
    }
    #message-box {
      position: absolute;
      top: 28px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 4px;
      display: none;
      white-space: nowrap;
      user-select: none;
      z-index: 10;
    }
    .msg-success { background-color: #00b7a3; color: #fff; }
    .msg-error { background-color: #000; color: #fff; }

    .honeycomb {
      position: relative;
      width: 200px;
      height: 220px;
      margin-bottom: 20px;
    }
    .letter {
      position: absolute;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: #e9ebf0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: 700;
      font-size: 20px;
      color: #2c2c2c;
      cursor: pointer;
      user-select: none;
      transition: transform .1s ease;
    }
    .letter:active { transform: scale(.9); }
    .center { background: var(--primary) !important; color: #fff !important; }

    .controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 260px;
    }
    .btn {
      padding: 8px 20px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      background: #f2f2f2;
      font-weight: 600;
      cursor: pointer;
      min-width: 100px;
      user-select: none;
      transition: transform .1s ease;
    }
    .btn:active { transform: scale(.97); }
    .btn.hints { background: #d9f1ed; color: var(--primary); font-weight: 700; }
    .btn.confirm { background: var(--primary); color: #fff; }

    .right-panel { width: 400px; max-width: 100%; }
    .progress {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 12px;
      margin-bottom: 10px;
    }
    .progress-bar {
      height: 6px;
      background: #d2f6f2;
      border-radius: 3px;
      overflow: hidden;
      margin-top: 4px;
    }
    .progress-fill {
      height: 100%;
      width: 0;
      background: var(--primary);
      transition: width .3s ease;
    }

    .word-list {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 6px;
      max-height: 240px;
      overflow-y: auto;
      font-size: 13px;
      text-transform: uppercase;
    }
    .word-box {
      background: #fff;
      border: 2px solid #f0f0f0;
      border-radius: 6px;
      padding: 8px;
      text-align: center;
      font-weight: 600;
      color: #888;
      user-select: none;
    }
    .word-box.found {
      background: #e0f8f4;
      color: #007f6c;
      border-color: #00b7a3;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    .word-box.found.animate { animation: pulse .5s ease-in-out; }

    .bottom-action { margin-top: 20px; text-align: center; }
    .end-btn {
      width: 100%;
      padding: 10px;
      background: #f8f8f8;
      border: none;
      font-weight: 600;
      border-radius: 6px;
      cursor: pointer;
    }

    #retryBtn {
      display: none;
      margin-top: 20px;
      padding: 10px 20px;
      background: #00b7a3;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
    }

    @media (max-width: 768px) {
      .container { flex-direction: column; align-items: center; gap: 30px; }
      .right-panel { width: 100%; order: -1; }
      .word-list { grid-template-columns: repeat(2, 1fr); font-size: 12px; }
      .honeycomb { transform: scale(.85); }
      .controls { max-width: 100%; }
      #timer { font-size: 20px; padding: 6px 10px; }
    }
  </style>
</head>
<body>
  <div id="timer">0s</div>

  <div class="container">
    <div class="left-panel">
      <div id="translate-container">
        Traduza: <span id="translate-word">---</span>
        <div id="message-box"></div>
      </div>
      <div id="typed-word"></div>
      <div class="honeycomb" id="honeycomb"></div>
      <div class="controls">
        <button class="btn" onclick="deleteLetter()">Apagar</button>
        <button class="btn" onclick="shuffleLetters()">üîÑ</button>
        <button class="btn" onclick="skipWord()">Pular</button>
        <button class="btn confirm" onclick="checkWord()">Confirmar</button>
        <button class="btn hints" id="toggleHintsBtn">Mostrar dicas</button>
      </div>
      <button id="retryBtn" onclick="restartGame()">üîÅ Jogar novamente</button>
    </div>

    <div class="right-panel">
      <div class="progress">
        <span id="levelText">N√≠vel 1</span>
        <span id="scoreText">0/0</span>
      </div>
      <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
      <h4 style="font-size:13px;margin:16px 0 8px;">Palavras j√° encontradas</h4>
      <div id="wordList" class="word-list"></div>
      <div class="bottom-action">
        <button class="end-btn" onclick="endGame()">‚èπÔ∏è Encerrar partida</button>
      </div>
    </div>
  </div>

 <script>
function removeAccents(str){ return str.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(); }
function shuffleArray(arr){ const c=[...arr]; for(let i=c.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[c[i],c[j]]=[c[j],c[i]];} return c; }

const levels = [
  [
    { en: "red", pt: "vermelho" },
    { en: "meat", pt: "carne" },
    { en: "cheese", pt: "queijo" },
    { en: "pizza", pt: "pizza" },
    { en: "tomato", pt: "tomate" }
  ],
  [
    { en: "salad", pt: "salada" },
    { en: "chocolate", pt: "chocolate" },
    { en: "cake", pt: "bolo" },
    { en: "rice", pt: "arroz" },
    { en: "beans", pt: "feijao" }
  ],
  [
    { en: "boy", pt: "garoto" },
    { en: "banana", pt: "banana" }
  ]
];

let currentLevel=0, wordPairs=[], generatedHives=[], currentIndex=0;
let typedWord="", centerLetter="", surroundingLetters=[], translatedStatus=[];
let showHints=false, timerInterval=null, timeLeft=0, accumulatedTime=0;

let firstWordSpoken = false;

const positions=[
  {top:0,left:68},{top:34,left:136},{top:102,left:136},{top:136,left:68},{top:102,left:0},{top:34,left:0}
];

const translateEl=document.getElementById('translate-word');
const typedEl=document.getElementById('typed-word');
const honeycombEl=document.getElementById('honeycomb');
const wordListEl=document.getElementById('wordList');
const scoreEl=document.getElementById('scoreText');
const progressEl=document.getElementById('progressFill');
const hintsBtn=document.getElementById('toggleHintsBtn');
const messageBox=document.getElementById('message-box');
const levelText=document.getElementById('levelText');
const timerEl=document.getElementById('timer');
const retryBtn=document.getElementById('retryBtn');

hintsBtn.addEventListener('click',()=>{
  showHints=!showHints;
  hintsBtn.textContent=showHints?'Ocultar dicas':'Mostrar dicas';
  renderWordList();
});

function initializeLevel(initialTime = 0){
  wordPairs = levels[currentLevel];
  generatedHives = wordPairs.map(pair => {
    const clean = removeAccents(pair.pt);
    const unique = [...new Set(clean.split(''))];
    const freq = {};
    for(const l of clean) freq[l] = (freq[l] || 0) + 1;
    const central = Object.entries(freq).sort((a,b)=>b[1]-a[1])[0][0];
    const others = unique.filter(l=>l!==central);
    const alphabet = 'abcdefghijklmnopqrstuvwxyz'.split('');
    let surround = [...others];
    const cleanSet = new Set([...surround]);
    while(cleanSet.size < 6){
      const r = alphabet[Math.floor(Math.random()*alphabet.length)];
      if(!cleanSet.has(r) && r !== central) cleanSet.add(r);
    }
    surround = Array.from(cleanSet).slice(0,6);
    return { hive: [central, ...surround], central, pair };
  });
  translatedStatus = wordPairs.map(() => false);
  currentIndex = 0;
  accumulatedTime = initialTime; 
  startGame();
}

function startGame(){
  showHints=false; hintsBtn.textContent='Mostrar dicas';
  levelText.textContent=`N√≠vel ${currentLevel+1}`;
  renderGameState(currentIndex);
}

function startTimer(){
  clearInterval(timerInterval);
  timeLeft = 10 + accumulatedTime;
  accumulatedTime = 0; 
  updateTimerDisplay();
  timerInterval=setInterval(()=>{
    timeLeft--;
    updateTimerDisplay();
    if(timeLeft <= 0){
      clearInterval(timerInterval);
      endChallenge();
    }
  },1000);
}

function updateTimerDisplay(){
  timerEl.textContent=`${timeLeft}s`;
  timerEl.style.color = timeLeft <= 5 ? 'red' : 'black';
}

function endChallenge(){
  showMessage("‚è∞ Tempo esgotado!",false);
  retryBtn.style.display='inline-block';
  honeycombEl.innerHTML="";
  clearInterval(timerInterval);
}

function renderGameState(idx){
  const {hive,central,pair}=generatedHives[idx];
  centerLetter=central;
  surroundingLetters=hive.filter(l=>l!==central);
  translateEl.textContent=pair.en.toUpperCase();
  speakEnglishWord(pair.en);
  typedWord=""; updateTypedDisplay();
  renderLetters(); renderWordList(); updateProgress();
  startTimer();
}

function renderLetters(){
  honeycombEl.innerHTML="";
  surroundingLetters.forEach((l,i)=>{
    const pos=positions[i];
    const div=document.createElement('div');
    div.className='letter'; div.style.top=`${pos.top}px`; div.style.left=`${pos.left}px`;
    div.textContent=l.toUpperCase(); div.onclick=()=>addLetter(l);
    honeycombEl.appendChild(div);
  });
  const cdiv=document.createElement('div');
  cdiv.className='letter center'; cdiv.style.top='68px'; cdiv.style.left='68px';
  cdiv.textContent=centerLetter.toUpperCase(); cdiv.onclick=()=>addLetter(centerLetter);
  honeycombEl.appendChild(cdiv);
}

function addLetter(l){ typedWord+=l; updateTypedDisplay(); }
function clearWord(){ typedWord=""; updateTypedDisplay(); } /

function deleteLetter(){
  if(typedWord.length > 0){
    typedWord = typedWord.slice(0, -1);
    updateTypedDisplay();
  }
}
function updateTypedDisplay(){
  typedEl.innerHTML=""; 
  for(const ch of typedWord.toUpperCase()){
    const s=document.createElement('span');
    if(ch.toLowerCase()===centerLetter)s.style.color='var(--primary)';
    s.textContent=ch;
    typedEl.appendChild(s);
  }
}

function shuffleLetters(){ surroundingLetters=shuffleArray(surroundingLetters); renderLetters(); }

function skipWord(){ goToNext(); }

function checkWord(){
  if(!typedWord) return;
  const w = typedWord.toLowerCase();
  const target = generatedHives[currentIndex].pair.pt.toLowerCase();
  const isNew = !translatedStatus[currentIndex];

  if(w === target && isNew){
    translatedStatus[currentIndex] = true;
    typedWord = "";
    updateTypedDisplay();

    accumulatedTime = timeLeft;

    showMessage("Boa!", true);

    renderWordList(); 
    updateProgress();

    if(translatedStatus.every(v => v)){
      clearInterval(timerInterval);
      if(currentLevel < levels.length - 1){
        setTimeout(() => nextLevel(), 1500);
      } else {
        showMessage("Voc√™ concluiu todos os n√≠veis! üèÜ", true);
      }
    } else {
      clearInterval(timerInterval);
      setTimeout(() => goToNext(), 1500);
    }

  } else {
    showMessage("Palavra incorreta", false);
  }
}

function nextLevel() {
  if(currentLevel > 0 && accumulatedTime <= 0){
    showMessage("Voc√™ n√£o acumulou tempo suficiente para avan√ßar!", false);
    retryBtn.style.display = 'inline-block';
    return;
  }
  
  currentLevel++;
  initializeLevel(accumulatedTime);
}

function goToNext(){
  const len=generatedHives.length;
  for(let i=1;i<=len;i++){
    const idx=(currentIndex+i)%len;
    if(!translatedStatus[idx]){ currentIndex=idx; renderGameState(idx); return; }
  }
}

function renderWordList(){
  wordListEl.innerHTML='';
  wordPairs.forEach((pair,idx)=>{
    const div=document.createElement('div');
    div.className='word-box';
    if(translatedStatus[idx]){ div.classList.add('found','animate'); div.textContent=pair.pt.toUpperCase(); }
    else if(showHints){ div.textContent=pair.pt.toUpperCase(); }
    else div.textContent=`${pair.pt.length} letras`;
    wordListEl.appendChild(div);
  });
}

function updateProgress(){
  const done=translatedStatus.filter(v=>v).length;
  const total=translatedStatus.length;
  scoreEl.textContent=`${done}/${total}`;
  progressEl.style.width = total ? (done/total)*100 + '%' : '0%';
}

function showMessage(text,success){
  clearTimeout(messageBox._timeout);
  messageBox.textContent=text;
  messageBox.className='';
  messageBox.classList.add(success?'msg-success':'msg-error');
  messageBox.style.display='inline-block';
  messageBox._timeout=setTimeout(()=>messageBox.style.display='none',2000);
}

function restartGame(){ location.reload(); }

function endGame(){
  if(confirm("Deseja encerrar a partida?")) {
    clearInterval(timerInterval);  
    timeLeft = 0;                
    updateTimerDisplay();          
    retryBtn.style.display = 'inline-block'; 
    honeycombEl.innerHTML = "";    
  }
}

function speakEnglishWord(word){
  if('speechSynthesis' in window){
    const u=new SpeechSynthesisUtterance(word);
    u.lang='en-US'; u.rate=0.85;
    speechSynthesis.cancel(); speechSynthesis.speak(u);
  }
}

initializeLevel();
</script>
</body>
</html>
